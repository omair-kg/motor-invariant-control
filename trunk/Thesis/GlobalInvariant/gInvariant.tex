\chapter{GLOBAL MOTOR INVARIANT}
\label{chap:gi}
\section{Introduction}

\nomenclature[a1]{$q$}{Generalized Coordinates}
\nomenclature[a2]{$\qd$}{Gneralized Velocity}
\nomenclature[a3]{$\state$}{State Variable}
\nomenclature[a4]{$u$}{Control Input}

\nomenclature[b1]{$Q$}{Configuration Space or Configuration Manifold}
\nomenclature[b2]{$TQ$}{Tangent Bundle of $Q$}
\nomenclature[b3]{$M$}{State Space Manifold}
\nomenclature[b4]{$TM$}{Tangent Bundle Manifold}



\nomenclature[c1]{$A$}{Attractor}
\nomenclature[c2]{$B(A)$}{Basin of Attraction of $A$}
\nomenclature[c3]{$\simeq$}{Topology Conjungacy}



\nomenclature[d1]{$S$}{Neural Oscillator}
\nomenclature[d2]{$\uin$}{Input Signal to the Neural Oscillator}
\nomenclature[d3]{$\uout$}{Output of the Neural Oscillator}
\nomenclature[d4]{$\hin$}{Input Coefficient of the Neural Oscillator}
\nomenclature[d5]{$\hout$}{Output Coefficient of the Neural Oscillator}



%\nomenclature[zcif]{$CIF$}{Cauchy's Integral Formula}                                % first letter Z is for Acronyms 
%\nomenclature[aF]{$F$}{complex function}                                                   % first letter A is for Roman symbols
%\nomenclature[gp]{$\pi$}{ $\simeq 3.14\ldots$}                                             % first letter G is for Greek Symbols
%\nomenclature[gi]{$\iota$}{unit imaginary number $\sqrt{-1}$}                      % first letter G is for Greek Symbols
%\nomenclature[gg]{$\gamma$}{a simply closed curve on a complex plane}  % first letter G is for Greek Symbols
%\nomenclature[xi]{$\oint_\gamma$}{integration around a curve $\gamma$} % first letter X is for Other Symbols
%\nomenclature[rj]{$j$}{superscript index}                                                       % first letter R is for superscripts
%\nomenclature[s0]{$0$}{subscript index}                                                        % first letter S is for subscripts




\graphicspath{{GlobalInvariant/GlobalInvariantFigs/EPS/}{GlobalInvariant/GlobalInvariantFigs/}}


Motions vary greatly, different people will walk with different gaits. 
A question \cms research neglected is why the word ``walk'' applies to different gaits.
From the perspective of motor invariant theory, the word ``Walk'' capture the qualitative properties of a category of motions.
We agree on the word ``walk'' also because it is an inborn ability encoded in our body.
``Walk'' is the word for one motion primitive.


Motion Primitives are ''easy'' motion tasks. 
For the intutive idea for  ``easiness'', a clear mathematical defination is needed.
This chapter developed the mathematical conceptualization of Global Motor Invariant.
New mathematical tools are introduced.
Throughout this thesis,  geometrical perspective is adopted for discussion of the dynamic systems.
Qualitative properties are analyzed with the tool of differential topology.
This idea can be traced back to Poincare\citep{Poincar'e1899,Poincar'e1885} and recently developed by the Smale School\citep{Smale1970}.
It is impossible to include the whole discipline.
Please refer to book \citep{abraham1978foundations}for introduction in details.


Dynamic motions are modelled as differential equations.
From the geometrical perspective, a differential equation describes a differentiable manifold.
Qualitative properties can be obtained by analyzing the topological structure of the differentiable manifold.
\emph{Global Motor Invariants} are identified by the topology structure.


\section{Basic Concepts}



\subsection{Dynamic Systems and Differentiable Manifold}
Motions of a mechanical system is determined by its configuration  $q$ in posture space $Q$ and generalized speed $\qd$ in the tangent space $T_{q}Q$. 
Define the state value $\state=[q,\qd] \in M$,  $M$ is the state space, or state manifold.
A motion is a trajectory $t \mapsto q(t)$ in the configuration space parameterized by time~$t$.
For a dynamic system, $q(t)$ usually is derived from the state trajectory $\state(t)$, which is described by differential equation. 



For every point $\state \in M$, 
$F$ and $u$ determines a derivative vector $\dot{\state}$ in the \emph{Tangent Space}~$T_{\state}M$. 
Vectors over the full space of $\state$ form the \emph{vector field} $\mathbf{V}$,describe by the differential equaiton~ \ref{eq:ode}.
which is described by the differential equation

\begin{equation}
\label{eq:ode}
\dot{\state}=F_{\alpha}(\state)+u
\end{equation}



where $u$ is the control effort. 
$\alpha$ is the system parameters
$F$ is determined by the system's natural property.
If $u=0$,  no control effort is applied.
Such systems are \emph{autonomous systems}. 

Solutions to equation~\ref{eq:ode} is the \emph{intergral curve}. 
\emph{Flow} $\Phi(\state)$ of $\mathbf{V}$ is the \emph{integral curve} through~$\state$. 
All the flows form the \emph{phase portrait}, which illustrates all the possible motions of the dynamic system.
Differential manifolds are usually visualized by \emph{phase plot}.

\textbf{Example}

For the mass-spring system, define state variable~$\state=[q,\qd]$, Equation~\ref{eq:mass-spring} can be transformed into the equation~\ref{eq:stateform}.
\begin{equation}
\label{eq:stateform}
\dot{\state}=
\left[ 
\begin{array}{cc}
0 &1\\
-1 &0 
\end{array}
\right]\state
\end{equation}



\subsection{Basin of Attraction}
Intersections of follows are \emph{equilibria}.
Basically there are three types of equilibria.
At each \textbf{equilbria}, the local space can be divided into three subspace: 
\emph{centre manifold}, \emph{stable manifold}, and \emph{unstable manifold}.
\begin{description} 
\item[centre manifold]
For a flow $\phi_c$ pass through a point $\state_{c}$ on centre sub manifold $W_{c}$, $\phi_c$ will remain on the Centre Manifold. 
\[
\phi_{c}(t) \in W_{c}, t \in R
\]

\item [stable manifold]
For a flow $\phi_{s}$ passes through a point $\state_{s}$ on stable sub manifold $W_{s}$, $\phi_s$ will finally converge to a flow $\phi_c$ on centre manifold.
\[
\phi_{s}(+\infty)=\phi_{c}
\]
\item[unstable manifold]
For a flow $\phi_u$ passes through a point $\state_u$ on unstable manifold $W_{u}$, $\phi_u$ will be repelled from the $\phi_c$ on centre manifold, the inverse of $\phi_u$ converges to $\phi_c$. 
\[
\phi_{u}(-\infty)=\phi_{c}
\] 
\end{description}


\textbf{Attractors} are the equilbrias where the whole local space is stable, the dimension of unstable manifold is zero.
\textbf{Repellors} are the equilibrias where the whole local space is unstable,the dimension of stable manifold is zero.







In theory, only the attractors of the dynamic systems can be observed.
Two types of attractors are of great interest in motor control:
\begin{enumerate}
 \item fixed point, as show inf Figure~\ref{fig:StablePosture}.
 \item Limit Cycle,as shown in Figure ~\ref{fig:limit_circle}
\end{enumerate}
\begin{figure}
\begin{center}
\label{fig:limit_circle}
\includegraphics[height=0.4\textheight]{phase_plot}
\caption{Limit Cycle}
\end{center}
\end{figure}





For nonlinear dynamic systems, there may exist many attractors.
The phase plane will be divide into different regions,result in a cellular structure.
Within each region, all the flows will converge to one attractor ~$A$.
For the attractor, the region is  the \emph{basin of attraction} ~$B(A)$.

Figure~\ref{fig:manyboa} showns the landscape of plaseportaits of a dynamic system.
\begin{figure}
\begin{center}
\includegraphics[height=0.4\textheight]{basinOfAttraction}
\end{center}
\caption{Cellular Structure of Phase Space}
\label{fig:manyboa}
\end{figure}




\subsection{Topology Conjugacy}
The topological structure of a dynamic system can be described by the type of equlibrias and their connectivity.
Many dynamic systems have different dynamics but share the topology structure.
For example, the duffine system described by Equation ~\ref{eq:duffin} is different from the mass-spring system.
\begin{equation}
\label{eq:duffin}
\ddot{q}+q+q^{3}=0
\end{equation}

But the two system share the topology. 
Phase plot of the two system are show in Figure~\ref{fig:msphaseplot},\ref{fig:duffin}
Flows of the two systems are similar, and we can '' deform '' one into another.
This equivalence relationship is called \emph{topological conjugacy}.

\begin{figure}
\begin{center}
\includegraphics[height=0.4\textheight]{massspring}
\end{center}
\caption{Mass Spring System}
\label{fig:msphaseplot}
\end{figure}

\begin{figure}
\begin{center}
\includegraphics[height=0.4\textheight]{duffin}
\end{center}
\caption{Duffin Phase Plot}
\label{fig:duffin}
\end{figure}



\begin{mydef}
Let $M$ and $M^{'}$ be topological spaces, and let $F\colon M\to M$ and $F^{'}\colon M^{'}\to M^{'}$
be continuous functions. We say that $F$ is
\emph{topologically semiconjugate} to $F^{'}$, if there exists a continuous
surjection $T\colon M\to M^{'}$ such that $FT=TF^{'}$. If $T$ is a homeomorphism,
then we say that $F$ and $F^{'}$ are \emph{topologically conjugate}, and we call
$T$ a \emph{topological conjugation} between $F$ and $F^{'}$.
if two system are topological conjugate, they are \emph{analogous systems}
\end{mydef}




\section{Global Motor Invariant and Motion Adaptation}

For \cms application, ``easy'' motion tasks rely on attractors.
The qualitative property of a primitive is captured by the attractor and its basin of attraction.
If the attractor is fixed point, then he motion will be terminated.
if the attractor is limit cycle, then the motion will be periodic.
Larger basin of attraction means motion is more stable and narrow basin of attractions means the stability is fragile.

\begin{mydef}
\emph{Global Motor Invariant} is the tuple of attractor and its basin of attraction
\end{mydef}


In different situation, motions adapt because of different reasons.
Different perturbations generate different adaptations and requires different control strategy.

\begin{itemize}
\HiItem{State perturbation}

Perturbations that only affect the state $\state$ are \emph{State Perturbation}.
State Perturbations change the current state, the underlying dynamic system is unchanged.


If the perturbated state $\state^{'}$ is still in the basin of attraction, the flow will converge to the attractor. 
Different perturbations will result different flows and different motion, the the final motion result will remain the same.
Such kind of motion adaptation is \emph{Responsive Motion}.
For the walking example, state perturbations can be modelled , while the character and environment is not changed.

To make the character more responsive without motion failure,
Motion controller should enlarge the basin of attraction.






\HiItem{Structure Perturbation}
Structure Perturbations will affect the dynamic system.
Structure Perturbations happen commonly in our daily life, when a man put a heavy box on his shoulder, it will result a change in the dynamic system.



Structural Perturbations will change the shape of phase portrait; some will result in an analogous system.
Structural Perturbations will alter the  attractors, motion will change, this kind of motion adaptation is called \emph{system adaptation}.
For \cms, `` motion retargeting'' belongs to system adaptation.

Topological structure can not always maintained.
Some perturbations will result \emph{bifurcation} when the topology of the underlying dynamic system is changed.
As an  example is the damping perturbations on the mass spring system.
As show in Figure~\ref{fig:dampmass}

\begin{figure}
\begin{center}
\includegraphics[height=0.4\textheight]{spring_damping}
\end{center}
\caption{damping perturbation on mass spring system}
\label{fig:dampmass}
\end{figure}

The ability of a dynamic system maintaining its topology structure is \emph{structural stability}.
To make characters more adaptive to environment and body change, motor controller should boost the structural stability of the motion.
Control effort are taken to prevent bifurcation.
\end{itemize}


\subsection{Biological Explanations}
Motor Invariant Theory is an unification of many biological ideas.
For the  UMH, basin of attraction can be a model for the uncontrolled manifold. Motion variations comes from State Perturbation.
For \eph, attractor is a generalization of fix point.
Impedance control adjust the basin of attraction.


Structural Stability is neglected in \cms research.
It is reasonable for natural animals to rely on structural stability. 
In natural environment, perturbation and uncertainty are everywhere. 
Traditional ideas of feedback and generalization can't cope with all types of perturbations.
The alternaltive idea in motor invariant theory is we can neglected such perturbations, as long as the system is structural stable, no control effort is needed.
This idea will help \cms much of the computational burden.
And different adaptations are generated automatically through different perturbations.


For some phenomena, structural stability and qualitative perspective provides a better explanation than optimization and feedback control.
\begin{itemize}
\item
Qualitative Control Theory may help us understand the evolution of locomotion and neural Control.
Animals shift from the sea to the land. 
From quantitative perspective, the natural dynamics of the body and fluid environment are hard to predict or compute precisely. 
While from the qualitative perspective, fluid is continuous and uniform, the topological structure is simple and stable.
Thus with little neural control fish can maintain its posture. 
On the other side, for human walking, although the rigid body dynamic can be calculated precisely, but topological structure is much more complex. 
On the phase plane, there exist many equlibrias, the topology structure is more complex and unstable. 
More control system is needed mainly because of more complex qualitative dynamics.

\item
Qualitative theory can also help to explain another fact of biological motion system. 
Animals move through similar environment in a similar manner usually developed similar body structure, in spite of their different position on evolution chain for whales and fish example.
This is because animals moving in a similar manner base on the same motion primitive, similarity in body structure promise the topological conjugacy.
This idea may help us to understand the morphological computation. 
For one motion primitive, body evolves to provide us with a structural stable dynamic system.
This also implies motion primitives is determined by both body and environment.
\end{itemize}



\section{Global Motor Invariant Control}

In nature, body and environment can be extremely complex. 
The corresponding manifolds has complex topological structure, which provides many motion primitives.
For \cms application, the question is whether different motion primitives can be controlled with a simple and unified method.
The idea is that even there are many types of motion primitives, the number of attractor type is limited. 
Also even the dimension of dynamic system is large, the dimension of the attractors is not. 
Basically there are only two types of attractors
\begin{itemize}
\item Fix point is of zero dimension. 
\item Limit cycle is of one dimension.
\end{itemize}

Control Strategy are designed based on the type of attractor.


\subsection{\cpg and Entrainment}
Biology Research suggested that the motor is mainly controlled by the Central Pattern Generator, which is a small autonomous network that generating rhythmic signals.
The idea of control motion by rhythmic signals can be modelled as entrainment \citep{Gonz'alez-Miranda2004}.
When coupling two oscillation system together, entrainment happens when two system oscillate in synchronize. 
This effect also known as resonant will enhance the oscillating behaviour. 




In previous section, two types of attractors are discussed: Fixed Point and Limited Cycle. 
In biological research, it is a still under hot debate which type attractor serve as the foundations for motor control\citep{Degallier2010}.
Current idea is that Limit Cycle is necessary, based on limit cycle, fix point can be achieved by
\begin{enumerate} 
\item terminate a cycle. 
\item approximate by a limit circle with small amplitude.
\item Bifurcation. 
\end{enumerate}


In Motor Invariant Theory, currently only the limit cyle are considered, mainly for two reasons: 
\begin{itemize}
\HiItem {periodic behaviour is  common} 
Besides the periodic motions such as swimming and running, other biological activity like heart beating, wake and sleep  are periodic.
A periodic system has the potential to integrate with other biological simulation.

\HiItem{Similar Animation} 
For animations, periodic motions look similar to terminated motion when the amplitude is small. 
For \cms research, both types of motion trajectories can be synthesized with one system.
\end{itemize}

\subsection{Neural Oscillator Stability}
For neural system, precise computation is difficult,  building oscillator with neurons is easy. 
Only two neurons are needed with mutual inhibitive property.
One extensively studied oscillation model is developed by \citet{neurooscillation}. 
The mathematical presentation is as follows:
\begin{eqnarray}
\tau_{1} \dot{s_{1}}&=&c-s_{1}-\beta l_{1}-\gamma [s_{2}]^{+}-\sum_{j}h_{j}[w_{j}]^{+}\\
\tau_{2} \dot{l_{1}}&=&[s_{1}]^{+}-l_{1}\\
\tau_{1} \dot{s_{2}}&=&c-s_{2}-\beta l_{2}-\gamma [s_{1}]^{-}-\sum_{j}h_{j}[w_{j}]^{-}\\
\tau_{2} \dot{l_{2}}&=&[s_{2}]^{+}-l_{2}\\
y_{i}&=&\mbox{max}(s_{i},0)\\
y_{o}&=&=[s_{1}]^{+}-[s_{2}]^{+}=y_{1}-y{2}
\label{eq:matsuta}
\end{eqnarray}

$c$,$\beta$,$\gamma$ are parameters of the oscillator,in our research are kept constant.
$\tau$ controls the oscillation frequency.







Matuoka oscillator is an autonomous oscillator; 
it can begin to oscillator without any control effort.
Figure ~\ref{fig:natural-oscilation} shows the natural oscillator output.
\begin{figure}[h]
\includegraphics[height=0.4\textheight]{oscillation.eps}
\caption{Natural Oscillation}
\label{fig:natural-oscilation}
\end{figure}





It is also adaptive; entrainment behaviour can happen between one Matuoka oscillator and different oscillators. 
Figure \ref{fig:entraint-oscilation} shows the entrain oscillation,
where the oscillation of Matuoka oscillator synchronise with the input signal.
\begin{figure}[h]
\includegraphics[height=0.4\textheight]{entraint_oscilation.eps}
\caption{Entrainment Oscillation}
\label{fig:entraint-oscilation}
\end{figure}

But because of the nonlinear properties, its behaviour is not completely understood. 
Matsuta\citep{Matsuoka1987} explains the adaptive properties from the location of the roots of characteristic equation. 
Wilimas\citep{Williamson1998} explains the properties in frequency domain.



In our research, we find some important properties of neural oscillator by empirical.

\begin{figure}
\begin{center}
\includegraphics[height=0.5\textheight]{neuraloscilation1.eps}
\end{center}
\caption{The states of neural oscillator over Time}
\label{fig:oscilation}
\end{figure}

\begin{figure}
\begin{center}
\includegraphics[height=0.5\textheight]{neural1phase.eps}
\end{center}
\caption{The phase portrait of Neural Oscillators}
\label{fig:oscilationphase}
\end{figure}

From our simulation, we investigate the topological structure.
Basically, neural oscillator shows three important properties:
\begin{itemize}
\item{Simple Topological Structure.}
The topology structure of neural oscillator is simple, 
it includes one  attractive limit circle and one fix repellor.
\item{Large Basin of Attraction.}
All the simulations we carried out converged to the same limited circle.
\item{Fast Converging Speed.}
In most of the case, the flow will converge to the limit circle within one period time.
\end{itemize}

Features above are shown in Figure ~\ref{fig:time_timeAttraction}.
\begin{figure}
\begin{center}
\includegraphics[height=0.4\textheight]{neural_attraction.eps}
\end{center}
\caption{Neural output with different initial position}
\label{fig:time_timeAttraction}
\end{figure}

\begin{figure}
\begin{center}
\includegraphics[height=0.4\textheight]{neural_attraction_phase.eps}
\end{center}
\caption{Phase plot of oscillation with different initial condition}
\label{fig:phase_attraction}
\end{figure}
 
The large area of basin of attraction means the final behaviour is totally determined by parameters. 
Initial condition will have no effects on the oscillator final output. 
Thus we treat matsuta oscillator as in a simple one input, one out put system, controlled by three parameter and input signal. 
we usually reformed equation ~\ref{eq:matsuta} in the simplified form
\begin{equation}
\label{eq:simplematsuta}
\uout=S_{[\hin,\hout,\tau]}(\uin)
\end{equation}
where $\uin=\sum_{j}h_{j}[w_{j}]=hw$,$\uout=\hout y_{o}$





The converging speed can be seen as quick recovery ability.
When an impulse perturbation happens, it will recover in one period time.


\section{Example:Maintain Bouncing Height}

Bouncing ball is system ball bouncing by moving a pedal, a system with simple dynamic but difficult to control with optimization or Pd. 
While this example capture the complexity of human interaction with the environment and object. 
And can be the basic model for many motion tasks.

We show in this example how neural oscillator can turn the bouncing ball system into motion primitive.
\subsection*{Dynamics}
Hybrid dynamics, in incorporate two phase, 
 

\begin{align}
\ddot{q}&=-g&\mathrm{if}\,\,q &> 0\,\,\mathrm{(free\,\,flying)} \nonumber\\
\dot{q}^{+}_{\mathrm{ball}} - \dot{q}^{+}_{\mathrm{paddle}} &=  \epsilon(\dot{q}^{-}_{\mathrm{ball}} - \dot{q}^{-}_{\mathrm{paddle}})&\mathrm{if}\,\,q &\leq 0\,\,\mathrm{(paddle\,\,strike)}\nonumber
\end{align}

Basically, the ball will continue bouncing with smaller height,as show in Figure~\ref{fig:bborg}.

\begin{figure}[h]
\begin{center}
	\subfigure[state plot]
	{
	\includegraphics[width=0.45\textwidth]{bouncing_ball}
	\label{fig:bb}
	}
	\subfigure[Phase Plane]
	{
	\includegraphics[width=0.45\textwidth]{bouncing_ball_phaseplot}
	\label{fig:bbp}
	}
	
\end{center}
\caption{Original Bourncing Ball System}
\label{fig:bborg}
\end{figure}



\subsection*{Emergence of Limit Cycle}
couple with neural oscillator boucing we get an limit circle
The input of neural oscillator is the velocity $\uin=\dot{q}_{ball}$, the output of neural oscillator  drive the pedal position $q_{pedal}=\uout$.
A limit cycle emerges as the result of entrainment.
As show in figure drop from different position, all the ball will bouncing  about the same height of 5,as show in Figure~\ref{fig:bb_attractive_circle}

\begin{figure}[h]
\begin{center}
	\subfigure[state plot]
	{
	\includegraphics[width=0.45\textwidth]{bb_ms_os_attraction_phase}
	\label{fig:bb_attractive_entraint}
	}
	\subfigure[Phase Plane]
	{
	\includegraphics[width=0.45\textwidth]{bb_ms_os_StateTimeAttraction}
	\label{fig:bb_attractive_entraint_time}
	}
	
\end{center}
\caption{Attractive Limited Circle}
\label{fig:bb_attractive_circle}
\end{figure}

