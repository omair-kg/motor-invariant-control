\chapter{TOWARDS HIGH DIMENSION}
\label{chap:highdor}
\graphicspath{{HiDof/HiDofFigs/EPS/}{HiDof/HiDofFigs/}}
\section{Introduction}
In the previous chapters, motions are dynamically synthesized for characters with simplified dynamics.
A question arose that whether the  motor invariant theory(\moit) is applicable for characters with higher degrees of freedom.
For walk and stance examples, high degree system will incorporate the motions of the torso and arm.
Also for the snakes and fishes, synthesise motion for the flexible vertebrate may also be a challenge.
\moit provides a different perspective, and some of the challenge can be solved in a very different manner.



Redundant {\dof} is the key challenge in motion synthesis.
From the theoretical perspective of \moit, redundant {\dof s don't increase the computational burden exponentially.
\moit explores the natural dynamics of the body and the redundant {\dof} can move passively.
For the passive walker, all the \dof s are uncontrolled, increased {\dof} s will not increase controller burden.
The computational burden of neural oscillator remains constant during increase of {\dof} s in dynamic model.
The computational burden for controlled symmetry is trivial and increased linearly with the number of {\dof} s, as long as the symbolic equations of dynamics is given.

With high dimensional system,  the difficulties in applying \moit  come from  obtaining the symbolic equations.
This chapter focuses on techniques that avoid the developing high \dof symbolic equations.
Different strategies are developed for different situations.

\begin{itemize}
\HiItem{Negligible {\dof}s}
For characters of high {\dof}s, some {\dof}s can be simply neglected.
\moit is based on two concepts, the qualitative property and symmetry actions.
Some \dof s are neglected because either of the two reasons:
For some {\dof}s, for motion primitive, their motion is minor and has little effects on the system dynamic property, for such {\dof}s, controller system can be designed according to the simple model. 
The high dimensional model can be used for simulation, but will not affect the burden of control calculation.

For some other {\dof}s, their effects are equivalent to some group transform action, if group action controller is developed, effects of such {\dof}s can also be neglected.

\HiItem{Mechanical Coupling}
In certain occasions, the divide and conquer strategy works.
Instead of simulating and developing controllers for a complex mechanical system, The complex system is divided into many  low {\dof}s components, controllers are developed for each of them.

\HiItem{Time Offset}
In some cases, the motions of some {\dof}s are similar or mimic each other, the dynamics can be simplified as controlling just one {\dof}, and synthesis other {\dof} by mimic.
\end{itemize} 

\section{Negligible {\dof}s and Reduction}
\subsection{Negligible \dof}
Although biological mechanical structure is of high degree of freedom, many \dof s will have not affect the topology or qualitative properties.
For the walking example, \citet{Raibert1986} pointed out that walking is the same as a ball rolling down a slope while running is the same as ball bounding down a slope.
In our research, control strategy are developed based on the compass gait model, as shown in Figure~\ref{fig:compassgait}.
The degree of knees~\ref{fig:passivekneewalker} and foot~\ref{{fig:arcfoot}} will have little effects on the qualitative properties.
\begin{figure}[!htbp]
  \begin{center}
      \includegraphics[width=0.7\textwidth]{compassgait}
    \caption{Compass Gait}
    \label{fig:}
\end{center}
\end{figure}



\begin{figure}[!htbp]
  \begin{center}
      \includegraphics[width=0.7\textwidth]{rollfoot}
    \caption{Arc Foot Walker}
    \label{fig:arcfoot}
\end{center}
\end{figure}






Although the compass gait and arc foot model are different from  our walker with knee, the three model are all capable of passive walking and shows limit cycles of similar shapes, as shown in Figure~\ref{fig:compassgaitlimitcycle} and Figure~\ref{fig:arcfootlimitcycle}.
\begin{figure}[!htbp]
  \begin{center}
      \includegraphics[width=0.7\textwidth]{compasGaitLimitCycle}
    \caption{the limit cycle of compass gait}
    \label{fig:compassgaitlimitcycle}
\end{center}
\end{figure}

\begin{figure}[!htbp]
  \begin{center}
      \includegraphics[width=0.7\textwidth]{arcfoot}
    \caption{the Limit Cycle of arcfoot}
    \label{fig:arcfootlimitcycle}
\end{center}
\end{figure}


This idea may be understood through the perturbation or averaging theory\citep{khalil2002nonlinear}.
Motions of some {\dof}s are relatively small, or have little effects on the topology.
From an alternative perspective, such motions are treated as perturbations,  for the knee walking example, the relatively small motion of knee is equivalent to perturbation of the leg length and the mass position.



Following this idea, feet are added to the original walker.
From experiment, the angle is almost rigid and the motion is relatively small.
From experience, foot will boost the stability.
Our hypothesis is that addition the feet prolongs the double stance time, thus effort are applied to push the state towards the limit cycle.

This effects is modelled by the simplified liner model, as shown in Equation~\ref{eq:footheelstrike}.
\begin{equation}
\label{eq:footheelstrike}
\dot{q}_{st}=(1-r)\dot{q}_{st}+r\dot{q}^{desir}_{st}
\end{equation}
where the $\dot{q}_{st}$ is the state after the heel strike,
$r$ is the linear ration, if foot action push the walker to normal perfectly, then $r=1$,
$\dot{q}^{desir}_{st}$ is the desired state, or the state on the limit cycle.


Adding feet will change the shape of limit cycle, only make the original limit cycle more stable.
The gait is shown in Figure~\ref{fig:ToeGait}.
\begin{figure}[!htbp]
  \begin{center}
      \includegraphics[width=0.7\textwidth]{walkwithtoe}
    \caption{Walking with Toe}
    \label{fig:ToeGait}
\end{center}
\end{figure}


%And all the four system, can apply the same kind of symmetry group.

%as show in Figure.

%\begin{figure}[!htbp]
%  \begin{center}
%      \includegraphics[width=0.7\textwidth]{Torus}
%    \caption{Approximate with Torus with a Circle}
%    \label{fig:approximate}
%\end{center}
%\end{figure}


%Following this idea, although not implemented in this research, more dofs like foot may also possible.
%But that's just an extra level of complexity, without modifying the principles. 
\subsection{Symmetry Reduction}
For some \dof s, their dynamics are not neglactable, but they will affect the dynamics in an unified manner.
The effects of such \dof can be neglected when the system is controlled under controlled symmetry.

This idea can help us to extend the 2D walker into 3D dimention.
Rather than develop the full 3D dynamcis, the effects of the motion in Coronal Plane and transverse plane can be modelled as transformation of the dynamics on spaghittal plane.


This can be analyzed by showing the sway angle in the coronal plane, as shown in Figure~\ref{fig:sidesway}.
\begin{figure}[!htbp]
  \begin{center}
      \includegraphics[width=0.7\textwidth]{Sidesway}
    \caption{Sideway}
    \label{fig:sidesway}
\end{center}
\end{figure}

When the walker have a sway angle $\alpha$, the gravity force on the sagittal phase are lowes thus the external force $N$ becomes $N'=cos(\alpha)N$
This has the same effect as applying speed action which the parameter $\ep, where \ep^2-1=\cos(\alpha)$.
The effects of sway can be simulated by adjust the speed action parameters$\ep$.
For walker with speed action control capacity, the effects of this \dof can be totally reduced.


Also the dynamic model is free of the rotation on the transverse plane.
If the ground is rotating around the tranverse plane at constant speed, then only the centrifigual force is generated perpendiculator to the sagittal plane, this force is easilly componsated by the friction on the foot.

For the walker make a turning, the spahittal plane is rotate in an constant speed, this can be achievied by actuating the yaw joint of the suppoting leg, as shown in Figure~\ref{fig:turn}.
The gait is shown in ~\ref{fig:walkturn}

\begin{figure}[!htbp]
  \begin{center}
      \includegraphics[width=0.7\textwidth]{turn}
    \caption{Turn Actuation}
    \label{fig:turn}
\end{center}
\end{figure}



\begin{figure}[!htbp]
  \begin{center}
  $
     \begin{array}{ccccc}
\includegraphics[width=1in]{turn/0001.eps}&
\includegraphics[width=1in]{turn/0201.eps}&
\includegraphics[width=1in]{turn/0301.eps}&
\includegraphics[width=1in]{turn/0401.eps}&
\includegraphics[width=1in]{turn/0501.eps}
\\
\includegraphics[width=1in]{turn/0601.eps}&
\includegraphics[width=1in]{turn/0701.eps}&
\includegraphics[width=1in]{turn/0801.eps}&
\includegraphics[width=1in]{turn/0901.eps}&
\includegraphics[width=1in]{turn/1001.eps}
\\
\includegraphics[width=1in]{turn/1101.eps}&
\includegraphics[width=1in]{turn/1201.eps}&
\includegraphics[width=1in]{turn/1301.eps}&
\includegraphics[width=1in]{turn/1401.eps}&
\includegraphics[width=1in]{turn/1501.eps}
\\
\includegraphics[width=1in]{turn/1601.eps}&
\includegraphics[width=1in]{turn/1701.eps}&
\includegraphics[width=1in]{turn/1801.eps}&
\includegraphics[width=1in]{turn/1901.eps}&
\includegraphics[width=1in]{turn/2001.eps}
\\
\includegraphics[width=1in]{turn/2101.eps}&
\includegraphics[width=1in]{turn/2201.eps}&
\includegraphics[width=1in]{turn/2301.eps}&
\includegraphics[width=1in]{turn/2401.eps}&
\includegraphics[width=1in]{turn/2501.eps}

\end{array}$
    \caption{Walk And Turn}
    \label{fig:walkturn}
\end{center}
\end{figure}





\section{Mechanical Coupling}
Some mechanical system can be treated as connecting many different simple components together.
the different parts of motion formed mechanical entrainment.
if a mechanical system is model like
\[
\dot{\state}=F(\state)
\]
the state is $\state=[q_1,q_2,\qd_1,\qd_2]$
we can reform the the dynamic equation in the manner
$\state=[\state_1,\state_2]$
where
$\state_1=[q_1,\qd_1]$
$\state_2=[q_2,\qd_2]$

and  the original dynamic equation can be formulated as
\begin{align}
\dot{\state}_1&=F_1(\state_1)+C_1(\state_1,\state_2)\nonumber\\
\dot{\state}_2&=F_2(\state_2)+C_2(\state_1,\state_2),\nonumber
\end{align}

if $C_{1,2} \ll F_{1,2}$, then the dynamic will be dominated by $F_{1,2}$ and $C_{1,2}$ can be treated as perturbation.
Controller can be designed according to $F_{1,2}$

\subsection*{Branches Mechanical Structure}
In fact any mechanical system can be reformulated as entrainment netwok,
a proper method should separate different components when the coupling is weak.
the weak couple joint can be found through the mechanical structure.

when have mechanical structure in figure
\begin{figure}[!htbp]
  \begin{center}
      \includegraphics[width=0.5\textwidth]{multilink}
    \caption{brances mechanical structure}
    \label{fig:branches structure}
\end{center}
\end{figure}

original dynamic system should be of 5 DOF and develop the full dynamic system should be of 5 by 5 matrix.
in the following form


\[
M\left[\begin{array}{c}
\ddot{q}_{1}\\
\ddot{q}_{2}\\
\ddot{q}_{3}\\
\ddot{q}_{4}\\
\ddot{q}_{5}\end{array}\right]+C\left[\begin{array}{c}
\dot{q}_{1}\\
\dot{q}_{2}\\
\dot{q}_{3}\\
\dot{q}_{4}\\
\dot{q}_{5}\end{array}\right]+\left[\begin{array}{c}
N_{1}(q_{1})\\
N_{2}(q_{2})\\
N_{3}(q_{3})\\
N_{4}(q_{4})\\
N_{5}(q_{5})\end{array}\right]=\left[\begin{array}{c}
u_{1}\\
u_{2}\\
u_{3}\\
u_{4}\\
u_{5}\end{array}\right]
\]

where
\[
M=\left[\begin{array}{ccccc}
m_{11} & m_{12} & m_{13} & m_{14} & m_{15}\\
m_{12} & m_{22} & m_{23} & m_{24} & m_{25}\\
m_{13} & m_{23} & m_{33} & m_{34} & m_{35}\\
m_{14} & m_{24} & m_{34} & m_{44} & m_{45}\\
m_{15} & m_{25} & m_{35} & m_{45} & m_{55}\end{array}\right]
\]

and
\[
C=\left[\begin{array}{ccccc}
0 & C_{12}\dot{q_{2}} & C_{13}\dot{q}_{3} & C_{14}\dot{q}_{4} & C_{15}\dot{q}_{5}\\
-C_{12}\dot{q_{1}} & 0 & C_{23}\dot{q}_{3} & C_{24}\dot{q}_{4} & C_{25}\dot{q}_{5}\\
-C_{13}\dot{q_{1}} & -C_{23}\dot{q}_{2} & 0 & C_{34}\dot{q}_{4} & C_{35}\dot{q}_{5}\\
-C_{14}\dot{q_{1}} & -C_{24}\dot{q}_{2} & -C_{34}\dot{q}_{3} & 0 & C_{45}\dot{q}_{5}\\
-C_{15}\dot{q_{1}} & -C_{25}\dot{q}_{2} & -C_{35}\dot{q}_{3} & -C_{45}\dot{q}_{4} & 0\end{array}\right]
\]





while for the braches structure in Figure \ref{fig:branches structure}.
there the efficient between different branches $4,5$ and $2,3$ will be zero.

where
\[
M=\left[\begin{array}{ccccc}
m_{11} & m_{12} & m_{13} & m_{14} & m_{15}\\
m_{12} & m_{22} & m_{23} & 0 & 0\\
m_{13} & m_{23} & m_{33} & 0 & 0\\
m_{14} & 0 & 0 & m_{44} & m_{45}\\
m_{15} & 0 & 0 & m_{45} & m_{55}\end{array}\right]
\]

and
\[
C=\left[\begin{array}{ccccc}
0 & C_{12}\dot{q_{2}} & C_{13}\dot{q}_{3} & C_{14}\dot{q}_{4} & C_{15}\dot{q}_{5}\\
-C_{12}\dot{q_{1}} & 0 & C_{23}\dot{q}_{3} & 0 & 0\\
-C_{13}\dot{q_{1}} & -C_{23}\dot{q}_{2} & 0 & 0 & 0\\
-C_{14}\dot{q_{1}} & 0 & 0 & 0 & C_{45}\dot{q}_{5}\\
-C_{15}\dot{q_{1}} & 0 & 0 & -C_{45}\dot{q}_{4} & 0\end{array}\right]
\]








They happens when they the mechanical have a branch structure.
when mechanical have a branch structure,
the dynamic equation will be in the following manner.
where
\[
M=\left[\begin{array}{ccc|cc}
m_{11} & m_{12} & m_{13} & m_{14} & m_{15}\\
m_{12} & m_{22} & m_{23} & 0 & 0\\
m_{13} & m_{23} & m_{33} & 0 & 0\\ \hline
m_{14} & 0 & 0 & m_{44} & m_{45}\\
m_{15} & 0 & 0 & m_{45} & m_{55}\end{array}\right]
=\left[\begin{array}{cc}
M_{33} & M_{c32}\\
M_{c32} & M_{22}\end{array}\right]
\]

and
\[
C=
\left[\begin{array}{ccc|cc}
0 & C_{12}\dot{q_{2}} & C_{13}\dot{q}_{3} & C_{14}\dot{q}_{4} & C_{15}\dot{q}_{5}\\
-C_{12}\dot{q_{1}} & 0 & C_{23}\dot{q}_{3} & 0 & 0\\
-C_{13}\dot{q_{1}} & -C_{23}\dot{q}_{2} & 0 & 0 & 0\\ \hline
-C_{14}\dot{q_{1}} & 0 & 0 & 0 & C_{45}\dot{q}_{5}\\
-C_{15}\dot{q_{1}} & 0 & 0 & -C_{45}\dot{q}_{4} & 0\end{array}\right]
=\left[\begin{array}{cc}
c_{33} & c_{c32}\\
c_{c32} & c_{22}\end{array}\right]
\]
based on where the mechanical branches, we can separate the dynamic equation into two parts,
and simulate them independently and form the mechanical entrainment network.


\[
M_{33}\left[\begin{array}{c}
\ddot{q}_{1}\\
\ddot{q}_{2}\\
\ddot{q}_{3}\end{array}\right]+C_{33}\left[\begin{array}{c}
\dot{q}_{1}\\
\dot{q}_{2}\\
\dot{q}_{3}\end{array}\right]+\left[\begin{array}{c}
N_{1}(q_{1})\\
N_{2}(q_{2})\\
N_{3}(q_{3})\end{array}\right]=\left[\begin{array}{c}
u_{1}\\
u_{2}\\
u_{3}\end{array}\right]-\left[\begin{array}{c}
m_{14}\ddot{q}_{4}+m_{15}\ddot{q}_{5}\\
0\\
0\end{array}\right]-\left[\begin{array}{c}
c_{14}\dot{q}_{4}^{2}+c_{15}\dot{q}_{5}^{2}\\
0\\
0\end{array}\right]
\]

\[
M_{22}\left[\begin{array}{c}
\ddot{q}_{4}\\
\ddot{q}_{5}\end{array}\right]+C_{22}\left[\begin{array}{c}
\dot{q}_{4}\\
\dot{q}_{5}\end{array}\right]+\left[\begin{array}{c}
N_{4}(q_{4})\\
N_{5}(q_{5})\end{array}\right]=\left[\begin{array}{c}
u_{1}\\
u_{2}\end{array}\right]-\left[\begin{array}{c}
m_{14}\\
m_{15}\end{array}\right]\ddot{q}_{1}-\left[\begin{array}{c}
-c_{14}\\
-c_{15}\end{array}\right]\dot{q}_{1}^{2}
\]

according the mechanical structure, this is equivalent to simulate two part of the mechanical structure independently and perturbation are treated as coupling effects.
\begin{figure}[!htbp]
  \begin{center}
      \includegraphics[width=0.7\textwidth]{multilinkCoupled}
    \caption{mechanical coupling}
    \label{fig:mechcouple}
\end{center}
\end{figure}








\subsection{Torsol And Arm}
using this mechanical coupling method, we can incorporate the arm and torso motion is our dynamic system.
for the torso, the angle is $q_{tor}$,with mass $m_{tor}$ and the distance from the hip is $l_{tor}$
then we can add the torso motion to the knee walker, then the walking motion of the lower body becomes
\begin{equation}
\label{eq:walkcouplewithtorso}
M\ddot{q}+C\dot{q}+N=u-\left[\begin{array}{c}
m_{tor}l_{tor}Lcos(q_{1}-q_{tor})\ddot{q}_{tor}\\
0\\
0\end{array}\right]-\left[\begin{array}{c}
m_{tor}l_{tor}Lsin(q_{1}-q_{tor})\dot{q}_{tor}^{2}\\
0\\
0\end{array}\right]
\end{equation}

by analyzing the equation, if the torque posture kept still, it will have no effects on the lower body walking.
In real life walking, the upper body usually keep straight upward, the coupling input from the upper body is very small.



the torso motion is an inverted pendulum plus some perturbation from the lower body.
\[
m_{tor}l_{tor}^{2}\ddot{q}_{tor}=gm_{tor}l_{tor}sin(q_{tor})-(m_{tor}l_{tor}Lcos(q_{1}-q_{tor})\ddot{q}_{1}-m_{tor}l_{tor}Lsin(q_{1}-q_{tor})\dot{q}_{1}^{2})
\]
by analyzing the torso motion equation, torso motion is unstable in nature, there must be some control applied to maintain its posture.

We are not clear what the kind of controller is applied for maintain the torso posture.
The control method adopted by this research is by shaping the potential energy.
Although inverted pendulum is not stable, pendumlum is stable.
Torque is applied to make the torso work like pendulum.

\begin{figure}[!htbp]
  \begin{center}
      \includegraphics[width=0.5\textwidth]{torsoAndLeg}
    \caption{The Mechanical Entrainment of Leg And Torso}
    \label{fig:torsolegentrainment}
\end{center}
\end{figure}



Simple PD controller will work well, but it does not necessary generating believable motion.
An upper body motion is close related to motion purpose and not determined by natural dynamic properties.For application purpose, maybe it is unnecessary to find a controller for upper body motion.
We can use procedure or other ``IK'' method to generate upper body motion, and add the dynamic effects to the lower body walking motion.
The motion of arm can be incorporated by following the same principles, it is just another level of complexity.


\section{Time Shift}

For some sepere and fish, the mechanical system is in chain and involves lots of similar joints.
such system dof can't be neglected or reduced through symmetry and through mechanical coupling.

For these kind of mechanical structures, an adhoc method is proposed.
The hypothesis is for each joint, since the dynamics is similar.
Thus the same control strategy is applied for every joint.
joint are differentiate by the group action.
This method potentially have two application.


The first idea is applying this method for the boid system.
Original boid system is ruled based, but method don't promise stability.
While we using group theory for simulation bold system, if all the agent using the same neural oscillator, they will converge to the same limit circle,
The uniformity of final motion of agent is grantified.
The different in the agent of modelled by lie group symmetry, different group action is applied to different agents, behavior will change accordingly.
For such application, a important group action is the Time Shift.



The fish example in Figure~\ref{fig:fishplot} has $8$ joint,  which are controlled by the \cpg s with the same parameters but  different initial condition.
They will result in the same limit cycle but maintain the phase difference.


we expend this boid example to model the fish swimming.
The fish is made up 8 links, and each dof is controlled by a neural oscillator.

\begin{figure}[!htbp]
  \begin{center}
      \includegraphics[width=0.5\textwidth]{fish_plot}
    \caption{CPG for Fish}
    \label{fig:fishplot}
\end{center}
\end{figure}




Simplified dynamic model are use.
each joint is modelled as a spring system.
\begin{equation}
\label{eq:fishdynamics}
\ddot{q}=Kq
\end{equation}

The swimming speed is proposinal to the square of the viborating velocity.
All the group action can be used.
Offset Action will result the fish turnning,
Speed Action will make the fish swim more fast.
Energy Action will modify the swimming intensity.


Figure~\ref{fig:fishswimming} and Figure~\ref{fig:fishswimline} shows the swimming gaits in a line.
Figure~\ref{fig:fishswimturn} shwo the the turning gait.

\begin{figure}[!htbp]
  \begin{center}
      \includegraphics[width=0.5\textwidth]{fish_swimming}
    \caption{Swimming Motion by our method}
    \label{fig:fishswimming}
\end{center}
\end{figure}



\begin{figure}[!htbp]
\begin{center}
      \includegraphics[width=\textwidth]{SwimLine}
    \caption{Fish Swim}
    \label{fig:fishswimline}
\end{center}
\end{figure}


\begin{figure}[!htbp]
\begin{center}
      \includegraphics[width=\textwidth]{SwimTurn}
    \caption{Fish Swim Turn}
    \label{fig:fishswimturn}
\end{center}
\end{figure}









